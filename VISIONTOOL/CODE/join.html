<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 - 비전툴</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <header id="header">
            <div id="title">
                <div id="WebName">
                    <a @click="fnMain" class="noDeco">
                        <span class="material-symbols-outlined logo-icon">construction</span>
                        <span class="nanum-gothic-regular">비전툴 </span>
                        <span class="nanum-gothic-extrabold"> VISIONTOOL</span>
                    </a>
                </div>
                <div id="title-Search"></div>
                <div id="rightBox"></div>
            </div>
            <nav id="category"></nav>
        </header>

        <main id="container" class="join-container">
            <div class="join-box">
                <div class="nanum-gothic-extrabold detailTitle">회원가입</div>
                
                <div class="input-group">
                    <label for="userId">아이디</label>
                    <div class="input-with-button">
                        <input type="text" id="userId" v-model="userId" placeholder="아이디를 입력하세요" :disabled="idCheck">
                        <button class="btn btn-secondary" @click="fnCheckId" :disabled="idCheck">{{ idCheck ? '확인완료' : '중복확인' }}</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="userPsd">비밀번호</label>
                    <input type="password" id="userPsd" v-model="userPsd" placeholder="비밀번호를 입력하세요">
                </div>

                <div class="input-group">
                    <label for="userEmail">이메일</label>
                    <input type="text" id="userEmail" v-model="userEmail" placeholder="example@email.com">
                </div>

                <div class="input-group">
                    <label for="userName">닉네임</label>
                    <input type="text" id="userName" v-model="userName" placeholder="닉네임을 입력하세요">
                </div>
                
                <div class="input-group">
                    <label for="userPhone">전화번호</label>
                    <input type="text" id="userPhone" v-model="userPhone" placeholder="'-' 없이 숫자만 입력">
                </div>

                <div class="input-group">
                    <label>주소</label>
                    <div class="input-with-button">
                        <input type="text" v-model="userAddr" placeholder="도로명주소" readonly>
                        <button class="btn btn-secondary" @click="execDaumPostcode">주소찾기</button>
                    </div>
                    <input type="text" v-model="userDetailAddr" placeholder="상세주소를 입력하세요" class="mt-10">
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" @click="fnJoin">가입하기</button>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-info">
                    <span class="material-symbols-outlined iconSmall">call</span>
                    <span>032-515-8024</span>
                </div>
                <div class="footer-info">
                    <span class="material-symbols-outlined">location_on</span>
                    <span>인천광역시 부평구 길주로 416-4 (산곡동 119-33)</span>
                </div>
                 <div class="footer-info">
                    <span>(주)비전툴</span>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>

<script>
    const app = Vue.createApp({
        data() {
            return {
                idCheck: false,
                userId: "",
                userPsd: "",
                userEmail: "",
                userName: "",
                userPhone: "",
                userAddr: "",
                userDetailAddr: ""
            };
        },
        methods: {
            fnJoin() {
                let self = this;
                if (!self.idCheck) {
                    alert("아이디 중복 확인을 해주세요.");
                    return;
                }
                if (!self.userId || !self.userPsd || !self.userName || !self.userEmail) {
                    alert("필수 정보를 모두 입력해주세요.");
                    return;
                }

                let param = {
                    userId: self.userId,
                    userPsd: self.userPsd,
                    userEmail: self.userEmail,
                    userName: self.userName,
                    userPhone: self.userPhone,
                    userAddr: self.userAddr,
                    userDetailAddr: self.userDetailAddr
                };
                
                $.ajax({
                    url: "http://localhost:3009/tools/join",
                    dataType: "json",
                    type: "GET",
                    data: param,
                    success: function (data) {
                        alert("회원가입이 완료되었습니다!");
                        location.href = `login.html`;
                    },
                    error: function(xhr, status, error) {
                        console.error("Join failed:", error);
                        alert("회원가입 중 오류가 발생했습니다.");
                    }
                });
            },
            fnCheckId() {
                let self = this;
                if (self.userId.trim() === "") {
                    alert("아이디를 입력해주세요.");
                    return;
                }
                let param = { userId: self.userId };
                $.ajax({
                    url: "http://localhost:3009/tools/checkid",
                    dataType: "json",
                    type: "GET",
                    data: param,
                    success: function (data) {
                        if (data.info === undefined) {
                            alert("사용 가능한 아이디입니다.");
                            self.idCheck = true;
                        } else {
                            alert("이미 사용 중인 아이디입니다.");
                            self.idCheck = false;
                        }
                    }
                });
            },
            execDaumPostcode() {
                let self = this;
                new daum.Postcode({
                    oncomplete: function(data) {
                        self.userAddr = data.roadAddress;
                    }
                }).open();
            },
            fnMain() {
                location.href = "main.html";
            }
        },
        mounted() {
            this.idCheck = false;
        }
    });

    app.mount('#app');
</script>